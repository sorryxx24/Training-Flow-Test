<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‡ºåŒ—å¸‚æ”¿åºœæ¶ˆé˜²å±€ 114å¹´æ•™è‚²è¨“ç·´ç®¡ç†ç³»çµ± (V11.0)</title>
    
    <!-- æ ¸å¿ƒå·¥å…·åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* --- æ ¸å¿ƒè®Šæ•¸ --- */
        :root {
            --sidebar-bg: #1e293b; --active-item: #334155; --accent: #3b82f6;
            --bg-color: #f1f5f9; --border-color: #333; /* æ”¹ç‚ºæ·±è‰²é‚Šæ¡† */
            --header-bg: #f1f5f9;
        }

        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background-color: var(--bg-color); margin: 0; display: flex; height: 100vh; overflow: hidden; color: #333; }

        /* --- æ‰‹æ©Ÿç‰ˆ RWD è¨­å®š --- */
        .mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 900; }
        .hamburger { display: none; font-size: 24px; cursor: pointer; padding: 10px; color: #333; }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed; left: -260px; top: 0; bottom: 0; z-index: 1000; transition: 0.3s;
                box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            }
            .sidebar.open { left: 0; }
            .mobile-overlay.open { display: block; }
            .hamburger { display: block; }
            .top-bar { padding: 0 10px; }
            .page-title { font-size: 16px; }
            
            /* è¡¨æ ¼å®¹å™¨æ”¹ç‚ºå¯æ»‘å‹• */
            .table-container { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            
            /* æŒ‰éˆ•ç¾¤çµ„è®Šç›´æ’æˆ–ç¸®å° */
            .toolbar-group .btn-action { padding: 6px 10px; font-size: 12px; }
            .toolbar-group span { display: none; } /* éš±è—ç‹€æ…‹æ–‡å­— */
        }

        /* --- å´é‚Šæ¬„ --- */
        .sidebar { width: 240px; background-color: var(--sidebar-bg); color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-header { padding: 20px; background-color: #0f172a; border-bottom: 1px solid #475569; }
        .nav-item { padding: 15px 20px; cursor: pointer; border-left: 4px solid transparent; color: #94a3b8; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 14px; }
        .nav-item:hover { background-color: var(--active-item); color: white; }
        .nav-item.active { background-color: var(--active-item); color: var(--accent); border-left-color: var(--accent); font-weight: bold; }

        /* --- ä¸»å…§å®¹ --- */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .top-bar { height: 55px; background: white; border-bottom: 1px solid #ccc; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; flex-shrink: 0; }
        .page-title { font-size: 18px; font-weight: 600; color: #1e293b; }
        .toolbar-group { display: flex; gap: 5px; align-items: center; }

        .workspace { flex: 1; padding: 15px; overflow: hidden; display: flex; flex-direction: column; }
        .view-section { display: none; height: 100%; flex-direction: column; background: white; border: 1px solid #ccc; border-radius: 4px; overflow: hidden; }
        .view-section.active { display: flex; }
        .table-container { flex: 1; overflow: auto; background: #fff; }

        /* --- è¡¨æ ¼æ¨£å¼ (å·¥æ¥­é¢¨é»‘ç·š) --- */
        table { border-collapse: collapse; font-size: 13px; table-layout: fixed; width: auto; border-spacing: 0; }
        #table1 { min-width: 2000px; } #table2 { min-width: 1800px; } #table3 { min-width: 1400px; }
        
        /* ç”˜ç‰¹åœ–å¯¬åº¦ */
        #table4 { width: 1230px !important; } 
        
        th { background-color: var(--header-bg); color: #000; font-weight: 700; border: 1px solid #333; position: sticky; top: 0; z-index: 10; height: 50px; padding: 4px; box-sizing: border-box; }
        td { border: 1px solid #333; height: auto; min-height: 36px; background: white; position: relative; box-sizing: border-box; padding: 0; vertical-align: middle; }

        /* --- ç”˜ç‰¹åœ–ç¾åŒ– (V11) --- */
        .col-fix-name {
            width: 300px !important; min-width: 300px; max-width: 300px;
            white-space: normal; /* å…è¨±æ›è¡Œ */
            word-break: break-all; line-height: 1.3;
            box-sizing: border-box; padding: 5px; vertical-align: middle;
            border-right: 2px solid #000 !important; /* å³å´åŠ ç²— */
        }
        .col-fix-day {
            width: 30px !important; min-width: 30px; max-width: 30px;
            text-align: center; padding: 0 !important; box-sizing: border-box;
        }
        
        /* é€±æœ«èƒŒæ™¯è‰² (JS å‹•æ…‹åŠ å…¥ class weekend) */
        .weekend { background-color: #f3f4f6; }

        /* è¦–è¦ºèˆ‡æ•¸æ“šåˆ— */
        .gantt-visual-row { height: 20px; }
        .gantt-data-row { height: 28px; }
        
        .gantt-cell-bar { border-bottom: none; }
        .gantt-num { border-top: none; font-weight: bold; color: #000; font-size: 12px; }
        
        .bar-active { background-color: #3b82f6 !important; border-color: #000; -webkit-print-color-adjust: exact; print-color-adjust: exact; }

        /* æ¯å€‹æ´»å‹•å¤–åœåŠ ç²—æ¡† (é€é tbody border) */
        tbody.gantt-month-group { break-inside: avoid; page-break-inside: avoid; border-bottom: 3px solid #000; }
        .gantt-month-header td { background: #e2e8f0; font-weight: bold; padding-left: 15px; border: 2px solid #000; font-size: 14px; height: 32px; }
        
        /* çµ±è¨ˆåˆ— */
        .stats-row td { background-color: #f8fafc; border: 2px solid #000; color: #1e40af; font-weight: bold; text-align: center; }

        /* --- è¼¸å…¥å…ƒä»¶ --- */
        input[type="text"], input[type="number"] { width: 100%; height: 36px; border: none; outline: none; background: transparent; text-align: center; font-family: inherit; font-size: 13px; color: #000; display: block; }
        textarea { width: 100%; min-height: 36px; height: 100%; border: none; resize: none; outline: none; background: transparent; font-family: inherit; font-size: 13px; color: #000; text-align: left; padding: 5px; box-sizing: border-box; white-space: pre-wrap; overflow: hidden; display: block; }
        .date-cell { display: flex; align-items: center; height: 100%; } .date-cell input { flex: 1; }
        .btn-calendar { width: 30px; height: 100%; min-height: 36px; border: none; border-left: 1px solid #333; cursor: pointer; background: #eee; }
        
        /* --- Modal & Buttons --- */
        #loading { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; display: none; justify-content: center; align-items: center; color: white; flex-direction: column; font-size: 18px; backdrop-filter: blur(4px); }
        .spinner { width: 40px; height: 40px; border: 4px solid #fff; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 420px; padding: 20px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        
        .btn-action { padding: 8px 12px; border-radius: 4px; border: none; color: white; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 5px; font-weight: bold; white-space: nowrap; }
        .btn-save { background-color: #0f172a; } .btn-import { background-color: #64748b; } .btn-download { background-color: #16a34a; } .btn-print { background-color: #dc2626; } .btn-outline { background: white; border: 1px solid #cbd5e1; color: #333; }
        .col-yellow { background: #ffffcc; } .col-blue-light { background: #e0f2fe; } .col-red-light { background: #fee2e2; }

        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 15px 0; }
        .day-btn { padding: 8px; border: 1px solid #cbd5e1; background: white; cursor: pointer; text-align: center; border-radius: 4px; }
        .day-btn.active-range { background: #dbeafe; color: #1e40af; font-weight: bold; border-color: #3b82f6; }
        .day-btn.excluded { background: #64748b; color: white; text-decoration: line-through; }
        .print-month-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .month-select-btn { padding: 10px; border: 1px solid #cbd5e1; background: white; cursor: pointer; text-align: center; border-radius: 4px; font-weight: bold; }
        .month-select-btn.selected { background: #3b82f6; color: white; border-color: #2563eb; }

        /* --- åˆ—å°è¨­å®š (A3 æ©«å¼ + æ»¿ç‰ˆ) --- */
        @media print {
            @page { size: A3 landscape; margin: 5mm; }
            body { background: white; height: auto; overflow: visible; zoom: 100%; display: block !important; }
            .sidebar, .top-bar, .btn-add-row, .del-btn, .btn-calendar, #loading, #csvInput { display: none !important; }
            .main-content, .workspace, .view-section, .table-container { width: 100%; height: auto; overflow: visible; display: block; padding: 0; margin: 0; border: none; box-shadow: none; }
            .view-section { display: none; } .view-section.active { display: block; }
            
            /* ç”˜ç‰¹åœ–åˆ—å°æ»¿ç‰ˆ */
            #table4 { width: 100% !important; min-width: 100% !important; }
            .col-fix-name { width: 15% !important; min-width: 0 !important; white-space: pre-wrap !important; font-size: 10px !important; border: 1px solid #000 !important; }
            .col-fix-day { width: 2.7% !important; min-width: 0 !important; font-size: 9px !important; border: 1px solid #000 !important; }
            
            table, th, td { border: 1px solid #000 !important; }
            * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <div id="loading"><div class="spinner"></div><div id="loadText">è™•ç†ä¸­...</div></div>
    <div class="mobile-overlay" onclick="toggleSidebar()"></div>

    <!-- Modals -->
    <div id="dateModal" class="modal">
        <div class="modal-content">
            <div style="font-weight:bold;margin-bottom:10px;">æ’é™¤æ—¥æœŸ</div>
            <div id="modalRangeText" style="font-size:12px;color:#3b82f6;margin-bottom:10px;"></div>
            <div style="display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px;">
                <button class="btn-outline" style="padding:4px 8px;font-size:12px" onclick="applyDateFilter('all')">å…¨é¸</button>
                <button class="btn-outline" style="padding:4px 8px;font-size:12px" onclick="applyDateFilter('no-weekend')">æ’é™¤å…­æ—¥</button>
                <button class="btn-outline" style="padding:4px 8px;font-size:12px" onclick="applyDateFilter('only-weekend')">åƒ…é¸å…­æ—¥</button>
                <button class="btn-outline" style="padding:4px 8px;font-size:12px" onclick="applyDateFilter('clear')">æ¸…é™¤</button>
            </div>
            <div class="calendar-grid" id="calendarGrid"></div>
            <div style="text-align:right;margin-top:15px;">
                <button class="btn-outline" style="padding:6px 12px" onclick="closeModal('dateModal')">å–æ¶ˆ</button>
                <button class="btn-save" style="padding:6px 12px;color:white;border:none;border-radius:4px" onclick="saveDateModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <div id="printModal" class="modal">
        <div class="modal-content">
            <div style="font-weight:bold;margin-bottom:10px;">é¸æ“‡è¼¸å‡ºæœˆä»½</div>
            <div style="text-align:right;margin-bottom:10px;"><button class="btn-outline" style="padding:2px 6px;font-size:11px" onclick="toggleAllMonths()">å…¨é¸/åé¸</button></div>
            <div class="print-month-grid" id="printMonthGrid"></div>
            <div style="text-align:right;margin-top:15px;">
                <button class="btn-outline" style="padding:6px 12px" onclick="closeModal('printModal')">å–æ¶ˆ</button>
                <button class="btn-save" style="padding:6px 12px;color:white;border:none;border-radius:4px" onclick="executePrintOrExport()">åŸ·è¡Œ</button>
            </div>
        </div>
    </div>

    <!-- UI -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header"><h2>è¨“ç·´æµè·¯ç³»çµ±</h2></div>
        <nav>
            <div class="nav-item active" onclick="switchTab(1, this)">1. æ¶ˆé˜²äººå“¡</div>
            <div class="nav-item" onclick="switchTab(2, this)">2. éæ¶ˆé˜²äººå“¡</div>
            <div class="nav-item" onclick="switchTab(3, this)">3. é‡å¤§æ´»å‹•</div>
            <div class="nav-item" onclick="switchTab(4, this)">4. ç”˜ç‰¹åœ–</div>
        </nav>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div style="display:flex;align-items:center;gap:10px;">
                <div class="hamburger" onclick="toggleSidebar()">â˜°</div>
                <div class="page-title" id="pageTitle">é™„ä»¶1 - æ¶ˆé˜²äººå“¡</div>
            </div>
            <div class="toolbar-group" id="toolbar"></div>
        </div>

        <div class="workspace">
            <div id="view1" class="view-section active"><div class="table-container"><table id="table1"><thead><tr><th style="width:40px" class="del-btn">åˆª</th><th style="width:40px">é …æ¬¡</th><th style="width:40px">æœˆä»½</th><th style="width:100px">æ‰¿è¾¦å–®ä½</th><th style="width:200px">èª²ç¨‹åç¨±</th><th style="width:80px">è¨“ç·´å°è±¡</th><th style="width:140px">èª²ç¨‹æ—¥æœŸ</th><th style="width:120px">ä¸Šèª²åœ°é»</th><th style="width:40px">æ¢¯æ•¸</th><th style="width:50px">æ¯æ¢¯<br>äººæ•¸</th><th style="width:50px">åˆè¨ˆ<br>äººæ•¸</th><th style="width:50px">æ¯å¤©<br>æ™‚æ•¸</th><th style="width:50px">æ¯æ¢¯<br>æ™‚æ•¸</th><th style="width:50px">åˆè¨ˆ<br>æ™‚æ•¸</th><th style="width:100px" class="col-blue-light"><div class="th-content">é è¨ˆèª¿ç”¨äººæ•¸<br>(åˆ†éšŠäººåŠ›)</div></th><th style="width:120px" class="col-yellow"><div class="th-content">æ˜¯å¦æä¾›å®œåŸº<br>åŒ—æ¡ƒåƒè¨“</div></th><th style="width:60px" class="col-yellow"><div class="th-content">æš«è¨‚<br>æ–°åŒ—</div></th><th style="width:60px" class="col-yellow"><div class="th-content">æš«è¨‚<br>åŸºéš†</div></th><th style="width:60px" class="col-yellow"><div class="th-content">æš«è¨‚<br>æ¡ƒåœ’</div></th><th style="width:60px" class="col-yellow"><div class="th-content">æš«è¨‚<br>å®œè˜­</div></th><th style="width:150px">å‚™è¨»</th></tr></thead><tbody id="tbody1"></tbody></table></div><button class="btn-add-row" onclick="addRow(1)">+ æ–°å¢</button></div>
            <div id="view2" class="view-section"><div class="table-container"><table id="table2"><thead><tr><th style="width:40px" class="del-btn">åˆª</th><th style="width:40px">åºè™Ÿ</th><th style="width:40px">æœˆä»½</th><th style="width:100px">æ‰¿è¾¦å–®ä½</th><th style="width:200px">èª²ç¨‹åç¨±</th><th style="width:120px">è¨“ç·´å°è±¡</th><th style="width:140px">èª²ç¨‹æ—¥æœŸ</th><th style="width:120px">è¨“ç·´åœ°é»</th><th style="width:40px">æ¢¯æ•¸</th><th style="width:50px">æ¯æ¢¯<br>äººæ•¸</th><th style="width:50px">åˆè¨ˆ<br>äººæ•¸</th><th style="width:50px">æ¯å¤©<br>æ™‚æ•¸</th><th style="width:50px">æ¯æ¢¯<br>æ™‚æ•¸</th><th style="width:50px">åˆè¨ˆ<br>æ™‚æ•¸</th><th style="width:80px">èª¿ç”¨æœ¬å±€<br>æ•™å®˜äººæ•¸</th><th style="width:100px"><div class="th-content">æ˜¯å¦æä¾›<br>è·¨ç¸£å¸‚</div></th><th style="width:150px">å‚™è¨»</th></tr></thead><tbody id="tbody2"></tbody></table></div><button class="btn-add-row" onclick="addRow(2)">+ æ–°å¢</button></div>
            <div id="view3" class="view-section"><div class="table-container"><table id="table3"><thead><tr><th style="width:40px" class="del-btn">åˆª</th><th style="width:40px">åºè™Ÿ</th><th style="width:100px">æ‰¿è¾¦å–®ä½</th><th style="width:250px">é‡å¤§æ´»å‹•æ¼”ç¿’åç¨±</th><th style="width:150px">åƒåŠ å°è±¡</th><th style="width:140px">æ—¥æœŸ</th><th style="width:50px">å¤©æ•¸</th><th style="width:50px">æ™‚æ•¸</th><th style="width:100px" class="col-red-light"><div class="th-content">æ¯æ—¥èª¿ç”¨<br>å¤–å‹¤äººæ•¸</div></th><th style="width:150px">åœ°é»(æ•™å®¤)</th></tr></thead><tbody id="tbody3"></tbody></table></div><button class="btn-add-row" onclick="addRow(3)">+ æ–°å¢</button></div>

            <div id="view4" class="view-section">
                <div style="padding:10px;background:#fffbeb;font-size:13px;color:#92400e;border-bottom:1px solid #ccc;">âš ï¸ çµ±è¨ˆåŒ…å«é™„ä»¶1~3ã€‚è«‹æŒ‰ã€Œåˆ—å° PDFã€é¸æ“‡è¼¸å‡ºæœˆä»½ã€‚</div>
                <div class="table-container" id="ganttArea">
                    <table id="table4">
                        <thead><tr id="ganttHeader"><th class="col-fix-name">ç­æœŸ / æ´»å‹•åç¨±</th><!-- JS 1-31 --></tr></thead>
                        <tbody id="ganttContainer"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="csvInput" accept=".csv" style="display:none" onchange="processCSV(this)">

    <script>
        // ==========================================
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbxB06TURmbo4QW7ecb5OprxEF3mnJGve_Qkq64qvcyKTS0d4__4kmpzxFvJ9T6Cw0jKuQ/exec"; 
        // ==========================================

        let d1=[{m:'1',unit:'',name:'',date:'',mp:0,ex:[],isNew:true}], d2=[{m:'1',unit:'',name:'',date:'',inst:0,ex:[],isNew:true}], d3=[{unit:'',name:'',date:'',mp:0,ex:[],isNew:true}];
        let currentTab=1, printActionType='';

        window.onload = function() { updateToolbar(); loadData(); };
        function toggleSidebar(){ document.getElementById('sidebar').classList.toggle('open'); document.querySelector('.mobile-overlay').classList.toggle('open'); }

        function loadData() {
            if(GAS_API_URL.includes("è«‹è²¼ä¸Š")) { renderAll(); return; }
            showLoading(true, "åŒæ­¥ä¸­...");
            fetch(GAS_API_URL).then(r=>r.json()).then(res => {
                if(res.status==='success') {
                    d1 = (res.d1||[]).map(r=>({m:r[0],unit:r[1],name:r[2],target:r[3],date:r[4],loc:r[5],batch:r[6],pb:r[7],mp:r[12],ext:r[13]==='true',nt:r[14],kl:r[15],ty:r[16],yl:r[17],note:r[18],ex:JSON.parse(r[19]||'[]'),isNew:false,dh:r[9],bh:r[10]}));
                    d2 = (res.d2||[]).map(r=>({m:r[0],unit:r[1],name:r[2],target:r[3],date:r[4],loc:r[5],batch:r[6],pb:r[7],inst:r[12],ext:r[13]==='true',note:r[14],ex:JSON.parse(r[15]||'[]'),isNew:false,dh:r[9],bh:r[10]}));
                    d3 = (res.d3||[]).map(r=>({unit:r[0],name:r[1],target:r[2],date:r[3],days:r[4],hours:r[5],mp:r[6],loc:r[7],ex:JSON.parse(r[8]||'[]'),isNew:false}));
                    if(!d1.length) addRow(1); if(!d2.length) addRow(2); if(!d3.length) addRow(3);
                    renderAll();
                }
            }).catch(e=>alert(e)).finally(()=>showLoading(false));
        }

        function saveData() {
            if(GAS_API_URL.includes("è«‹è²¼ä¸Š")) return alert("è«‹è¨­å®š API URL");
            showLoading(true, "å„²å­˜ä¸­...");
            const p1=d1.map(r=>[r.m,r.unit,r.name,r.target,r.date,r.loc,r.batch,r.pb,(r.batch*r.pb)||0,r.dh,r.bh,(r.batch*r.bh)||0,r.mp,r.ext,r.nt,r.kl,r.ty,r.yl,r.note,JSON.stringify(r.ex)]);
            const p2=d2.map(r=>[r.m,r.unit,r.name,r.target,r.date,r.loc,r.batch,r.pb,(r.batch*r.pb)||0,r.dh,r.bh,(r.batch*r.bh)||0,r.inst,r.ext,r.note,JSON.stringify(r.ex)]);
            const p3=d3.map(r=>[r.unit,r.name,r.target,r.date,r.days,r.hours,r.mp,r.loc,JSON.stringify(r.ex)]);
            fetch(GAS_API_URL, {method:'POST',body:JSON.stringify({d1:p1,d2:p2,d3:p3}),headers:{'Content-Type':'text/plain'}}).then(r=>r.json()).then(res=>{if(res.status==='success'){alert("å„²å­˜æˆåŠŸ"); [d1,d2,d3].forEach(a=>a.forEach(r=>r.isNew=false)); renderAll();}else alert(res.message)}).finally(()=>showLoading(false));
        }

        function switchTab(idx, el) {
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active')); el.classList.add('active');
            document.querySelectorAll('.view-section').forEach(e=>e.classList.remove('active')); document.getElementById(`view${idx}`).classList.add('active');
            currentTab=idx; document.getElementById('pageTitle').innerText = ["é™„ä»¶1-æ¶ˆé˜²","é™„ä»¶2-éæ¶ˆé˜²","é™„ä»¶3-æ´»å‹•","ç”˜ç‰¹åœ–"][idx-1];
            updateToolbar(); if(idx===4) renderGantt();
            if(window.innerWidth<=768) document.getElementById('sidebar').classList.remove('open');
        }

        function updateToolbar() {
            const bar = document.getElementById('toolbar');
            let html = '';
            if(currentTab <= 3) {
                html += `<button class="btn-action btn-outline" onclick="downloadCSVTemplate()">ğŸ“¥ ç¯„æœ¬</button>`;
                html += `<button class="btn-action btn-import" onclick="document.getElementById('csvInput').click()">ğŸ“‚ åŒ¯å…¥</button>`;
                html += `<button class="btn-action btn-save" onclick="saveData()">â˜ï¸ å„²å­˜</button>`;
            } else {
                html += `<button class="btn-action btn-download" onclick="openPrintModal('excel')">ğŸ“¥ ä¸‹è¼‰Excel</button>`;
                html += `<button class="btn-action btn-print" onclick="openPrintModal('print')">ğŸ–¨ï¸ åˆ—å°PDF</button>`;
                html += `<button class="btn-action btn-print" style="background:#e11d48" onclick="openPrintModal('download')">ğŸ“„ ä¸‹è¼‰PDF</button>`;
            }
            bar.innerHTML = html;
        }

        function showLoading(s,t){ document.getElementById('loading').style.display=s?'flex':'none'; if(t)document.getElementById('loadText').innerText=t; }
        function updateMonthFromDate(t, i, val) { let match = val.match(/^(\d+)\//); if(match) { let m = match[1]; if(t===1) d1[i].m = m; if(t===2) d2[i].m = m; document.getElementById(`m_${t}_${i}`).value = m; } if(t===1) d1[i].date=val; if(t===2) d2[i].date=val; if(t===3) d3[i].date=val; }

        function renderAll(){ renderT1(); renderT2(); renderT3(); }
        // (ä¿ç•™ renderT1, T2, T3 åŸå§‹ HTML ç”Ÿæˆä»£ç¢¼ï¼Œæ­¤è™•å¾ç•¥ä»¥ç¯€çœç¯‡å¹…ï¼Œè«‹ç¢ºä¿è¤‡è£½å‰å¹¾ç‰ˆå®Œæ•´çš„ç”Ÿæˆé‚è¼¯)
        function renderT1(){const tb=document.getElementById('tbody1');tb.innerHTML='';d1.forEach((r,i)=>{tb.innerHTML+=`<tr><td style="text-align:center"><button class="del-btn" onclick="delRow(1,${i})" style="border:none;background:none;color:#94a3b8;cursor:pointer;">âœ•</button></td><td><input type="text" value="${i+1}" readonly style="color:#999"></td><td><input type="text" id="m_1_${i}" value="${r.m||''}" readonly style="background:#f1f5f9;color:#64748b"></td><td><input type="text" value="${r.unit||''}" onchange="d1[${i}].unit=this.value"></td><td class="align-left"><textarea onchange="d1[${i}].name=this.value">${r.name||''}</textarea></td><td><input type="text" value="${r.target||''}" onchange="d1[${i}].target=this.value"></td><td><div class="date-cell"><input type="text" value="${r.date||''}" onchange="updateMonthFromDate(1,${i},this.value)" placeholder="1/6-19"><button class="btn-calendar" onclick="openDateModal(1,${i})">ğŸ“…</button></div></td><td><input type="text" value="${r.loc||''}" onchange="d1[${i}].loc=this.value"></td><td><input type="number" value="${r.batch||''}" onchange="d1[${i}].batch=this.value"></td><td><input type="number" value="${r.pb||''}" onchange="d1[${i}].pb=this.value"></td><td style="background:#f1f5f9;text-align:center;line-height:36px">${(r.batch*r.pb)||0}</td><td><input type="number" value="${r.dh||''}" onchange="d1[${i}].dh=this.value"></td><td><input type="number" value="${r.bh||''}" onchange="d1[${i}].bh=this.value"></td><td style="background:#f1f5f9;text-align:center;line-height:36px">${(r.batch*r.bh)||0}</td><td class="col-blue-light"><input type="number" value="${r.mp||''}" onchange="d1[${i}].mp=this.value" class="text-manpower"></td><td class="td-checkbox"><input type="checkbox" class="excel-checkbox" ${r.ext?'checked':''} onchange="d1[${i}].ext=this.checked"></td><td><input type="number" value="${r.nt||''}" onchange="d1[${i}].nt=this.value"></td><td><input type="number" value="${r.kl||''}" onchange="d1[${i}].kl=this.value"></td><td><input type="number" value="${r.ty||''}" onchange="d1[${i}].ty=this.value"></td><td><input type="number" value="${r.yl||''}" onchange="d1[${i}].yl=this.value"></td><td class="align-left"><input type="text" value="${r.note||''}" onchange="d1[${i}].note=this.value"></td></tr>`;});}
        function renderT2(){const tb=document.getElementById('tbody2');tb.innerHTML='';d2.forEach((r,i)=>{tb.innerHTML+=`<tr><td style="text-align:center"><button class="del-btn" onclick="delRow(2,${i})" style="border:none;background:none;color:#94a3b8;cursor:pointer;">âœ•</button></td><td><input type="text" value="${i+1}" readonly style="color:#999"></td><td><input type="text" id="m_2_${i}" value="${r.m||''}" readonly style="background:#f1f5f9;color:#64748b"></td><td><input type="text" value="${r.unit||''}" onchange="d2[${i}].unit=this.value"></td><td class="align-left"><textarea onchange="d2[${i}].name=this.value">${r.name||''}</textarea></td><td><input type="text" value="${r.target||''}" onchange="d2[${i}].target=this.value"></td><td><div class="date-cell"><input type="text" value="${r.date||''}" onchange="updateMonthFromDate(2,${i},this.value)"><button class="btn-calendar" onclick="openDateModal(2,${i})">ğŸ“…</button></div></td><td><input type="text" value="${r.loc||''}" onchange="d2[${i}].loc=this.value"></td><td><input type="number" value="${r.batch||''}" onchange="d2[${i}].batch=this.value"></td><td><input type="number" value="${r.pb||''}" onchange="d2[${i}].pb=this.value"></td><td style="background:#f1f5f9;text-align:center;line-height:36px">${(r.batch*r.pb)||0}</td><td><input type="number" value="${r.dHour||''}" onchange="d2[${i}].dHour=this.value"></td><td><input type="number" value="${r.bHour||''}" onchange="d2[${i}].bHour=this.value"></td><td style="background:#f1f5f9;text-align:center;line-height:36px">${(r.batch*r.bHour)||0}</td><td><input type="number" value="${r.inst||''}" onchange="d2[${i}].inst=this.value"></td><td class="td-checkbox"><input type="checkbox" class="excel-checkbox" ${r.ext?'checked':''} onchange="d2[${i}].ext=this.checked"></td><td class="align-left"><input type="text" value="${r.note||''}" onchange="d2[${i}].note=this.value"></td></tr>`;});}
        function renderT3(){const tb=document.getElementById('tbody3');tb.innerHTML='';d3.forEach((r,i)=>{tb.innerHTML+=`<tr><td style="text-align:center"><button class="del-btn" onclick="delRow(3,${i})" style="border:none;background:none;color:#94a3b8;cursor:pointer;">âœ•</button></td><td><input type="text" value="${i+1}" readonly style="color:#999"></td><td><input type="text" value="${r.unit||''}" onchange="d3[${i}].unit=this.value"></td><td class="align-left"><textarea onchange="d3[${i}].name=this.value">${r.name||''}</textarea></td><td><input type="text" value="${r.target||''}" onchange="d3[${i}].target=this.value"></td><td><div class="date-box"><input type="text" value="${r.date||''}" onchange="updateMonthFromDate(3,${i},this.value)"><button class="btn-calendar" onclick="openDateModal(3,${i})">ğŸ“…</button></div></td><td><input type="number" value="${r.days||''}" onchange="d3[${i}].days=this.value"></td><td><input type="number" value="${r.hours||''}" onchange="d3[${i}].hours=this.value"></td><td class="col-red-light"><input type="number" value="${r.mp||''}" onchange="d3[${i}].mp=this.value" class="text-danger"></td><td class="align-left"><input type="text" value="${r.loc||''}" onchange="d3[${i}].loc=this.value"></td></tr>`;});}

        // --- Gantt Logic (Visual Update) ---
        function renderGantt() {
            const h = document.getElementById('ganttHeader');
            h.innerHTML = '<th class="col-fix-name">ç­æœŸ / æ´»å‹•åç¨±</th>';
            for(let i=1; i<=31; i++) {
                // åˆ¤æ–·é€±æœ« (ä»¥ 2025 å¹´ 1 æœˆç‚ºä¾‹ï¼Œé€™è£¡åƒ…åšè¦–è¦ºå¾ªç’°ç¤ºæ„ï¼Œç²¾æº–éœ€é…åˆæœˆä»½)
                // ç‚ºäº†é€šç”¨ç¾è§€ï¼Œæˆ‘å€‘åœ¨æ ¼å­ç”Ÿæˆæ™‚å†åŠ 
                h.innerHTML += `<th class="col-fix-day">${i}</th>`;
            }
            const container = document.getElementById('ganttContainer'); container.innerHTML = '';
            
            let rows=[], parse = (r) => parseDateStr(r.date, r.ex);
            const add = (r,val,pre) => {
                let ds=parse(r), ms=[...new Set(ds.map(o=>o.m))].sort((a,b)=>a-b);
                ms.forEach(m=>{ rows.push({m:m, n:`${r.date} ${r.name} ${val>0?`(${pre}${val}äºº)`:''}`, ds:ds.filter(o=>o.m==m).map(o=>o.d), v:val}) });
            };
            d1.forEach(r=>{if(r.date&&r.mp)add(r,r.mp,'èª¿ç”¨')}); d2.forEach(r=>{if(r.date&&r.inst)add(r,r.inst,'æ•™å®˜')}); d3.forEach(r=>{if(r.date&&r.mp)add(r,r.mp,'èª¿ç”¨')});
            
            let grp={}; for(let i=1;i<=12;i++) grp[i]=[]; rows.forEach(r=>{if(grp[r.m])grp[r.m].push(r)});

            for(let m=1; m<=12; m++) {
                if(grp[m].length === 0) continue;
                let tbody = document.createElement('tbody');
                tbody.className = 'gantt-month-group';
                tbody.id = `month-${m}`;
                let html = `<tr class="gantt-month-header"><td class="fix-month" colspan="32">${m} æœˆä»½</td></tr>`;
                let sum = Array(32).fill(0);

                grp[m].forEach(r => {
                    let vis=`<tr class="gantt-visual-row"><td class="col-fix-name" style="border-right:1px solid #333;border-bottom:none;"></td>`;
                    let dat=`<tr class="gantt-data-row"><td class="col-fix-name" style="padding-left:10px;border-top:none;" title="${r.n}">${r.n}</td>`;
                    for(let i=1; i<=31; i++) {
                        let act = r.ds.includes(i), w = new Date(2025, m-1, i).getDay();
                        let wkCls = (w===0||w===6) ? 'weekend' : '';
                        if(act) sum[i]+=parseInt(r.v);
                        vis += `<td class="col-fix-day gantt-cell-bar ${wkCls} ${act?'bar-active':''}"></td>`;
                        dat += `<td class="col-fix-day gantt-num ${wkCls}">${act ? `<input type="text" value="${r.v}" readonly>` : ''}</td>`;
                    }
                    html += vis + '</tr>' + dat + '</tr>';
                });
                let sRow = `<tr class="stats-row"><td class="col-fix-name">æ¯æ—¥çµ±è¨ˆ</td>`;
                for(let i=1; i<=31; i++) {
                    let w = new Date(2025, m-1, i).getDay();
                    sRow += `<td class="col-fix-day ${w===0||w===6?'weekend':''}">${sum[i]}</td>`;
                }
                html += sRow + '</tr>';
                tbody.innerHTML = html; container.appendChild(tbody);
            }
        }

        function parseDateStr(str, excludeList) {
            let results = []; if(!str) return results;
            try {
                let s = str.replace(/ï¼ˆ.*?ï¼‰/g, '').replace(/\(.*?\)/g, '').trim();
                let parts = s.split(/[,ã€]/);
                parts.forEach(part => {
                    part = part.trim();
                    let cross = part.match(/(\d+)\/(\d+)\s*-\s*(\d+)\/(\d+)/);
                    if(cross) {
                        let m1=+cross[1], d1=+cross[2], m2=+cross[3], d2=+cross[4];
                        let cur = new Date(2025, m1-1, d1), end = new Date(2025, m2-1, d2);
                        while(cur <= end) { results.push({ m: cur.getMonth()+1, d: cur.getDate() }); cur.setDate(cur.getDate()+1); }
                        return;
                    }
                    let rng = part.match(/(\d+)\/(\d+)\s*-\s*(\d+)/);
                    if(rng) { let m=+rng[1], d1=+rng[2], d2=+rng[3]; for(let i=d1; i<=d2; i++) results.push({m:m, d:i}); return; }
                    let sgl = part.match(/(\d+)\/(\d+)/);
                    if(sgl) { results.push({m:+sgl[1], d:+sgl[2]}); }
                });
                if(excludeList && excludeList.length > 0) results = results.filter(o => !excludeList.includes(o.d));
            } catch(e) { console.error(e); }
            return results;
        }

        // --- Excel Fix: Merge Cell Logic ---
        async function exportExcelJS(selM) {
            const wb = new ExcelJS.Workbook();
            const sh = wb.addWorksheet('ç”˜ç‰¹åœ–');
            sh.getColumn(1).width = 50; for(let k=2;k<=32;k++) sh.getColumn(k).width=4;
            
            sh.addRow(["ç­æœŸ / æ´»å‹•åç¨±", ...Array.from({length:31},(_,k)=>k+1)]).eachCell(c=>{c.font={bold:true};c.fill={type:'pattern',pattern:'solid',fgColor:{argb:'FFf8fafc'}};c.border={top:{style:'thin'},left:{style:'thin'},bottom:{style:'thin'},right:{style:'thin'}};c.alignment={horizontal:'center'}});

            let rows=[]; const parse = (r) => parseDateStr(r.date, r.ex);
            const add = (r,val,pre) => { let ds=parse(r), ms=[...new Set(ds.map(o=>o.m))].sort((a,b)=>a-b); ms.forEach(m=>{ rows.push({ m: m, n: `${r.date} ${r.name} ${val>0?`(${pre}${val}äºº)`:''}`, ds: ds.filter(o=>o.m==m).map(o=>o.d), v: val }); }); };
            d1.forEach(r=>{if(r.date&&r.mp)add(r,r.mp,'èª¿ç”¨')}); d2.forEach(r=>{if(r.date&&r.inst)add(r,r.inst,'æ•™å®˜')}); d3.forEach(r=>{if(r.date&&r.mp)add(r,r.mp,'èª¿ç”¨')});
            let grp={}; for(let i=1;i<=12;i++) grp[i]=[]; rows.forEach(r=>{if(grp[r.m])grp[r.m].push(r)});

            selM.forEach(m => {
                if(grp[m].length===0) return;
                let mt = sh.addRow([`${m} æœˆä»½`]); mt.font={bold:true,size:12}; mt.getCell(1).fill={type:'pattern',pattern:'solid',fgColor:{argb:'FFe2e8f0'}};
                let sum=Array(32).fill(0);
                grp[m].forEach(r => {
                    // ä¿®æ­£ï¼šåç¨±å¡«å…¥ç¬¬ä¸€åˆ—
                    let dVis = [r.n]; // Visual Row has Name
                    let dDat = [""];   // Data Row is empty
                    for(let i=1;i<=31;i++) {
                        if(r.ds.includes(i)) { dVis.push(""); dDat.push(parseInt(r.v)); sum[i]+=parseInt(r.v); } else { dVis.push(""); dDat.push(""); }
                    }
                    let rVis = sh.addRow(dVis);
                    let rDat = sh.addRow(dDat);
                    
                    // Style Visual
                    rVis.eachCell((c,col)=>{
                        c.border={top:{style:'thick'},left:{style:'thin'},right:{style:'thin'}}; // Top Thick border for group
                        if(col===1) c.alignment={horizontal:'left',vertical:'middle',wrapText:true};
                        if(col>1 && r.ds.includes(col-1)) c.fill={type:'pattern',pattern:'solid',fgColor:{argb:'FF3b82f6'}};
                    });
                    // Style Data
                    rDat.eachCell((c,col)=>{
                        c.border={bottom:{style:'thick'},left:{style:'thin'},right:{style:'thin'}}; // Bottom Thick border
                        c.alignment={horizontal:'center',vertical:'middle'};
                        if(col>1 && r.ds.includes(col-1)) c.font={bold:true};
                    });
                    // Merge Name
                    sh.mergeCells(rVis.number, 1, rDat.number, 1);
                });
                let sd=["æ¯æ—¥çµ±è¨ˆ"]; for(let i=1;i<=31;i++) sd.push(sum[i]);
                let sr=sh.addRow(sd);
                sr.eachCell((c)=>{ c.fill={type:'pattern',pattern:'solid',fgColor:{argb:'FFf1f5f9'}}; c.font={bold:true,color:{argb:'FF1e40af'}}; c.border={top:{style:'double'},bottom:{style:'thick'},left:{style:'thin'},right:{style:'thin'}}; c.alignment={horizontal:'center'}; });
                sh.addRow([]);
            });
            const buf=await wb.xlsx.writeBuffer(); saveAs(new Blob([buf]), "ç”˜ç‰¹åœ–å ±è¡¨.xlsx");
        }

        // --- PDF Download ---
        function downloadPDF() {
            // ç‚ºäº†ä¸‹è¼‰ï¼Œæš«æ™‚ç§»é™¤ overflow: hidden é™åˆ¶
            document.body.style.overflow = 'visible';
            const element = document.getElementById('view4');
            // éš±è—æŒ‰éˆ•èˆ‡å…¶ä»–æœˆä»½
            const opt = {
                margin: 5, filename: 'ç”˜ç‰¹åœ–å ±è¡¨.pdf', image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, scrollY: 0 }, jsPDF: { unit: 'mm', format: 'a3', orientation: 'landscape' }
            };
            html2pdf().set(opt).from(element).save().then(() => {
                document.body.style.overflow = 'hidden'; // Restore
                // Restore display of all months
                for(let m=1;m<=12;m++){let tb=document.getElementById(`month-${m}`);if(tb)tb.style.display='table-header-group';}
            });
        }
        
        // Helper functions (Modal/CSV/Del) same as previous
        let curEdit=null;
        function openDateModal(t,i){curEdit={t,i};let r=(t==1?d1:t==2?d2:d3)[i];let rawDays=parseDateStr(r.date,[]);if(rawDays.length==0)return alert('è«‹å…ˆè¼¸å…¥æ­£ç¢ºæ—¥æœŸ');let firstM=rawDays[0].m;let daysInM=rawDays.filter(o=>o.m===firstM).map(o=>o.d);document.getElementById('modalRangeText').innerText=`ç·¨è¼¯æœˆä»½: ${firstM}æœˆ`;let grid=document.getElementById('calendarGrid');grid.innerHTML='';for(let d=1;d<=31;d++){let btn=document.createElement('div');btn.className='day-btn';btn.innerText=d;if(daysInM.includes(d)){btn.classList.add('active');if((r.ex||[]).includes(d))btn.classList.add('excluded');btn.onclick=()=>btn.classList.toggle('excluded');}else btn.classList.add('disabled');grid.appendChild(btn);}document.getElementById('dateModal').style.display='flex';}
        function closeModal(id){document.getElementById(id).style.display='none';}
        function saveDateModal(){let ex=Array.from(document.querySelectorAll('#calendarGrid .day-btn.active.excluded')).map(b=>parseInt(b.innerText));(curEdit.t==1?d1:curEdit.t==2?d2:d3)[curEdit.i].ex=ex;closeModal('dateModal');renderAll();}
        function applyDateFilter(type){let row=(curEdit.t==1?d1:curEdit.t==2?d2:d3)[curEdit.i];let m=row.m?parseInt(row.m):1;document.querySelectorAll('#calendarGrid .day-btn.active').forEach(b=>{let d=parseInt(b.innerText),dt=new Date(2025,m-1,d),w=dt.getDay();if(type=='all')b.classList.remove('excluded');if(type=='clear')b.classList.add('excluded');if(type=='no-weekend'){if(w==0||w==6)b.classList.add('excluded');else b.classList.remove('excluded');}if(type=='only-weekend'){if(w==0||w==6)b.classList.remove('excluded');else b.classList.add('excluded');}});}
        function openPrintModal(act){printActionType=act;const grid=document.getElementById('printMonthGrid');grid.innerHTML='';for(let m=1;m<=12;m++){let btn=document.createElement('div');btn.className='month-select-btn selected';btn.innerText=`${m} æœˆ`;btn.dataset.m=m;btn.onclick=()=>btn.classList.toggle('selected');grid.appendChild(btn);}document.getElementById('printModal').style.display='flex';}
        function toggleAllMonths(){let all=document.querySelectorAll('.month-select-btn');let hasUn=Array.from(all).some(b=>!b.classList.contains('selected'));all.forEach(b=>hasUn?b.classList.add('selected'):b.classList.remove('selected'));}
        function executePrintOrExport(){let selected=Array.from(document.querySelectorAll('.month-select-btn.selected')).map(b=>b.dataset.m);closeModal('printModal');for(let m=1;m<=12;m++){let tb=document.getElementById(`month-${m}`);if(tb)tb.style.display=selected.includes(String(m))?'table-header-group':'none';}if(printActionType==='print'){setTimeout(()=>{window.print();for(let m=1;m<=12;m++){let tb=document.getElementById(`month-${m}`);if(tb)tb.style.display='table-header-group';}},500);}else if(printActionType==='download'){setTimeout(()=>{downloadPDF();},500);}else{exportExcelJS(selected);for(let m=1;m<=12;m++){let tb=document.getElementById(`month-${m}`);if(tb)tb.style.display='table-header-group';}}}
        function delRow(t,i){let arr=t==1?d1:t==2?d2:d3;if(arr[i].isNew){arr.splice(i,1);renderAll();}else{if(prompt("è¼¸å…¥å¯†ç¢¼ (119) åˆªé™¤:")==="119"){arr.splice(i,1);renderAll();}}}
        function addRow(t){let o={isNew:true,ex:[],date:''};if(t==1)d1.push({...o,m:'',mp:0});if(t==2)d2.push({...o,m:'',inst:0});if(t==3)d3.push({...o,unit:'',mp:0});renderAll();}
        function downloadCSVTemplate(){let c="\uFEFF";if(currentTab==1)c+="æœˆä»½,æ‰¿è¾¦å–®ä½,èª²ç¨‹åç¨±,è¨“ç·´å°è±¡,èª²ç¨‹æ—¥æœŸ,ä¸Šèª²åœ°é»,æ¢¯æ•¸,æ¯æ¢¯äººæ•¸,æ¯å¤©æ™‚æ•¸,æ¯æ¢¯æ™‚æ•¸,é è¨ˆèª¿ç”¨äººæ•¸,æ˜¯å¦æä¾›å®œåŸºåŒ—æ¡ƒåƒè¨“,æ–°åŒ—,åŸºéš†,æ¡ƒåœ’,å®œè˜­,å‚™è¨»\n";if(currentTab==2)c+="æœˆä»½,æ‰¿è¾¦å–®ä½,èª²ç¨‹åç¨±,è¨“ç·´å°è±¡,èª²ç¨‹æ—¥æœŸ,è¨“ç·´åœ°é»,æ¢¯æ•¸,æ¯æ¢¯äººæ•¸,æ¯å¤©æ™‚æ•¸,æ¯æ¢¯æ™‚æ•¸,èª¿ç”¨æ•™å®˜äººæ•¸,æ˜¯å¦æä¾›è·¨ç¸£å¸‚,å‚™è¨»\n";if(currentTab==3)c+="æ‰¿è¾¦å–®ä½,é‡å¤§æ´»å‹•æ¼”ç¿’åç¨±,åƒåŠ å°è±¡,æ—¥æœŸ,å¤©æ•¸,æ™‚æ•¸,æ¯æ—¥èª¿ç”¨å¤–å‹¤äººæ•¸,åœ°é»\n";saveAs(new Blob([c],{type:'text/csv;charset=utf-8;'}),`ç¯„æœ¬_é™„ä»¶${currentTab}.csv`);}
        function processCSV(inp){if(!inp.files[0])return;Papa.parse(inp.files[0],{complete:function(res){if(res.data.length<2)return alert("ç„¡è³‡æ–™");let target=currentTab==1?d1:currentTab==2?d2:d3;res.data.forEach((r,i)=>{if(i==0||r.length<3)return;let o={isNew:true,ex:[]};if(currentTab==1){o.m=r[0];o.unit=r[1];o.name=r[2];o.target=r[3];o.date=r[4];o.loc=r[5];o.batch=r[6];o.pb=r[7];o.dh=r[8];o.bh=r[9];o.mp=r[10];o.ext=(r[11]=='æ˜¯');o.nt=r[12];o.kl=r[13];o.ty=r[14];o.yl=r[15];o.note=r[16];}else if(currentTab==2){o.m=r[0];o.unit=r[1];o.name=r[2];o.target=r[3];o.date=r[4];o.loc=r[5];o.batch=r[6];o.pb=r[7];o.dh=r[8];o.bh=r[9];o.inst=r[10];o.ext=(r[11]=='æ˜¯');o.note=r[12];}else{o.unit=r[0];o.name=r[1];o.target=r[2];o.date=r[3];o.days=r[4];o.hours=r[5];o.mp=r[6];o.loc=r[7];}target.push(o);});renderAll();alert("åŒ¯å…¥å®Œæˆï¼Œè«‹æŒ‰å„²å­˜");}});inp.value='';}
    </script>
</body>
</html>
